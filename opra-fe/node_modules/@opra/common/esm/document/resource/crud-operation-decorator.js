import { RESOURCE_METADATA } from '../constants.js';
export function createOperationDecorator(operation, init, list) {
    const decorator = ((target, propertyKey) => {
        if (propertyKey !== operation)
            throw new TypeError(`Name of the handler name should be '${operation}'`);
        const resourceMetadata = (Reflect.getOwnMetadata(RESOURCE_METADATA, target.constructor) || {});
        resourceMetadata.operations = resourceMetadata.operations || {};
        const operationMeta = { ...init };
        operationMeta.options = operationMeta.options || {};
        resourceMetadata.operations[operation] = operationMeta;
        for (const fn of list)
            fn(operationMeta, target, propertyKey);
        Reflect.defineMetadata(RESOURCE_METADATA, resourceMetadata, target.constructor);
    });
    decorator.Parameter = (name, arg0) => {
        const parameterOptions = typeof arg0 === 'string' || typeof arg0 === 'function' ? { type: arg0 } : { ...arg0 };
        list.push((operationMeta) => {
            operationMeta.parameters = operationMeta.parameters || {};
            operationMeta.parameters[name] = { ...parameterOptions };
        });
        return decorator;
    };
    return decorator;
}
