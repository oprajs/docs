"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ExpressAdapterHost = void 0;
const common_1 = require("@opra/common");
const http_adapter_host_js_1 = require("../http-adapter-host.js");
const http_server_request_js_1 = require("../http-server-request.js");
const http_server_response_js_1 = require("../http-server-response.js");
class ExpressAdapterHost extends http_adapter_host_js_1.HttpAdapterHost {
    constructor(app) {
        super();
        this._platform = 'express';
        this._app = app;
    }
    get app() {
        return this._app;
    }
    async init(api, options) {
        await super.init(api, options);
        this._api = api;
        const basePath = new common_1.OpraURLPath(options?.basePath);
        this._app.use(basePath.toString(), (_req, _res) => {
            const req = http_server_request_js_1.HttpServerRequest.from(_req);
            const res = http_server_response_js_1.HttpServerResponse.from(_res);
            this.handleHttp(req, res)
                .catch((e) => this._logger.fatal(e));
        });
    }
    static async create(app, api, options) {
        const adapter = new ExpressAdapterHost(app);
        await adapter.init(api, options);
        return adapter;
    }
}
exports.ExpressAdapterHost = ExpressAdapterHost;
