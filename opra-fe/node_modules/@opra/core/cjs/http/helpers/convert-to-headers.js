"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.convertToHeadersDistinct = exports.convertToHeaders = void 0;
const match_known_fields_js_1 = require("./match-known-fields.js");
function convertToHeaders(src, dst, joinDuplicateHeaders) {
    for (let n = 0; n < src.length; n += 2) {
        addHeaderLine(src[n], src[n + 1], dst, joinDuplicateHeaders);
    }
    return dst;
}
exports.convertToHeaders = convertToHeaders;
function convertToHeadersDistinct(src, dst) {
    const count = src.length % 2;
    for (let n = 0; n < count; n += 2) {
        addHeaderLineDistinct(src[n], src[n + 1], dst);
    }
    return dst;
}
exports.convertToHeadersDistinct = convertToHeadersDistinct;
function addHeaderLine(field, value, dest, joinDuplicateHeaders) {
    if (value == null)
        return;
    field = field.toLowerCase();
    const [, flag] = (0, match_known_fields_js_1.matchKnownFields)(field);
    // comma(0) or semicolon(2) delimited field
    if (flag === match_known_fields_js_1.COMMA_DELIMITED_FIELD || flag === match_known_fields_js_1.SEMICOLON_DELIMITED_FIELD) {
        // Make a delimited list
        if (typeof dest[field] === 'string') {
            dest[field] += (flag === match_known_fields_js_1.COMMA_DELIMITED_FIELD ? ', ' : '; ') + value;
        }
        else {
            dest[field] = value;
        }
    }
    else if (flag === match_known_fields_js_1.ARRAY_FIELD) {
        // Array header -- only Set-Cookie at the moment
        if (dest['set-cookie'] !== undefined) {
            dest['set-cookie'].push(value);
        }
        else {
            dest['set-cookie'] = [value];
        }
    }
    else if (joinDuplicateHeaders) {
        if (dest[field] === undefined) {
            dest[field] = value;
        }
        else {
            dest[field] += ', ' + value;
        }
    }
    else if (dest[field] === undefined) {
        // Drop duplicates
        dest[field] = value;
    }
}
function addHeaderLineDistinct(field, value, dest) {
    field = field.toLowerCase();
    if (!dest[field]) {
        dest[field] = [value];
    }
    else {
        dest[field].push(value);
    }
}
