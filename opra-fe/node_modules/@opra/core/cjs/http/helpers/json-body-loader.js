"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.jsonBodyLoader = void 0;
const tslib_1 = require("tslib");
const body_parser_1 = tslib_1.__importDefault(require("body-parser"));
const bodyLoaderCache = new WeakMap();
function jsonBodyLoader(options, cachePoint) {
    let bodyLoader = cachePoint ? bodyLoaderCache.get(cachePoint) : undefined;
    if (bodyLoader)
        return bodyLoader;
    const parser = body_parser_1.default.json({
        ...options,
        type: 'json'
    });
    bodyLoader = (incoming) => {
        return new Promise((resolve, reject) => {
            const next = (error) => {
                if (error)
                    return reject(error);
                resolve(incoming.body);
            };
            parser(incoming, {}, next);
        });
    };
    if (cachePoint)
        bodyLoaderCache.set(cachePoint, bodyLoader);
    return bodyLoader;
}
exports.jsonBodyLoader = jsonBodyLoader;
