import bodyParser from 'body-parser';
const bodyLoaderCache = new WeakMap();
export function jsonBodyLoader(options, cachePoint) {
    let bodyLoader = cachePoint ? bodyLoaderCache.get(cachePoint) : undefined;
    if (bodyLoader)
        return bodyLoader;
    const parser = bodyParser.json({
        ...options,
        type: 'json'
    });
    bodyLoader = (incoming) => {
        return new Promise((resolve, reject) => {
            const next = (error) => {
                if (error)
                    return reject(error);
                resolve(incoming.body);
            };
            parser(incoming, {}, next);
        });
    };
    if (cachePoint)
        bodyLoaderCache.set(cachePoint, bodyLoader);
    return bodyLoader;
}
