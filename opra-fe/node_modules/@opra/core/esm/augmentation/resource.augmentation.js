import { Collection, Resource, RESOURCE_METADATA, Singleton } from "@opra/common";
// @ts-ignore
const oldConstruct = Resource.prototype._construct;
// @ts-ignore
Resource.prototype._construct = function (init) {
    oldConstruct.call(this, init);
    const _this = this;
    _this.onInit = init.onInit;
    _this.onShutdown = init.onShutdown;
};
Collection.OnInit = Singleton.OnInit = function () {
    return (target, propertyKey) => {
        const sourceMetadata = (Reflect.getOwnMetadata(RESOURCE_METADATA, target.constructor) || {});
        sourceMetadata.onInit = target[propertyKey];
        Reflect.defineMetadata(RESOURCE_METADATA, target.constructor, sourceMetadata);
    };
};
Collection.OnShutdown = Singleton.OnShutdown = function () {
    return (target, propertyKey) => {
        const sourceMetadata = (Reflect.getOwnMetadata(RESOURCE_METADATA, target.constructor) || {});
        sourceMetadata.onShutdown = target[propertyKey];
        Reflect.defineMetadata(RESOURCE_METADATA, target.constructor, sourceMetadata);
    };
};
